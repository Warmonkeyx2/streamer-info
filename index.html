<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Streamer Info</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- INFO BUBBLE AND MAIN NAV -->
  <div class="info-bubble">
    <div class="info-button" onclick="toggleCard()">i</div>
    <div class="info-card" id="infoCard">
      <nav class="top-nav internal-nav">
        <button onclick="showTab('homeTab')">HOME</button>
        <button onclick="showTab('serversTab')">SERVERS</button>
        <button onclick="showTab('appsTab')">APPS</button>
        <div class="settings-icon" onclick="toggleAdminPanel()">‚öôÔ∏è</div>
      </nav>
      <div class="tab-content" id="homeTab">
        <img src="assets/profile.png" alt="Profile" />
        <h3>WARMONKEYX</h3>
        <p>
          Witness the madness unfold under the freeway. From explosive dumpster deals and sketchy science experiments to mysterious rituals beneath the full moon ‚Äî WarmonkeyX delivers raw, unscripted RP that blends chaos with character-driven lore.
          <br><br>
          If you crave unpredictable storylines, gritty humor, and explosive moments, this is your new religion.
        </p>
        <div class="streamer-links" id="mainStreamerLinks">
          <!-- Links dynamically filled by JS -->
        </div>
      </div>
      <div class="tab-content" id="serversTab" style="display: none;">
        <h3>Servers</h3>
        <p>Select your server type:</p>
        <div class="internal-nav" id="serverTypeButtons">
          <!-- Server type buttons dynamically generated by JS -->
        </div>
      </div>
      <div class="tab-content" id="gtaTab" style="display: none;">
        <h3>GTA RP Server</h3>
        <div id="gtaServerPanel"></div>
      </div>
      <div class="tab-content" id="redmTab" style="display: none;">
        <h3>RedM RP Server</h3>
        <div id="redmServerPanel"></div>
      </div>
      <div class="tab-content" id="appsTab" style="display: none;"> 
        <h3>Apps</h3>
        <p>Select a viewer app to open:</p>
        <div class="app-grid">
          <div class="app-icon" onclick="launchSolitaireApp()">
            <span>üÉè</span>
            <p>Solitaire</p>
          </div>
          <div class="app-icon" onclick="launchStatsApp()">
            <span>üìä</span>
            <p>Stats</p>
          </div>
          <div class="app-icon"><span>üì±</span><p>Mobile</p></div>
          <div class="app-icon" id="gamingAppIcon">
            <span>üéÆ</span>
            <p>Gaming</p>
          </div>
          <div class="app-icon" id="streamingAppIcon" onclick="toggleAppsVisibilityControls()">
            <span>üé•</span>
            <p>Streaming</p>
          </div>
          <div class="app-icon"><span>üß™</span><p>Experiments</p></div>
        </div>
        <div class="apps-visibility-controls" style="display:none;">
          <h4>Show/Hide Dock Buttons</h4>
          <label><input type="checkbox" class="dock-toggle" data-dock="streamInfoPanel" /> Stream Info</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="chatPanel" /> Chat</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="pollPanel" /> Polls</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="linksPanel" /> Links</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="" /> Links</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="customizeToggle" /> Customize</label><br>
          <button id="saveDockVisibility" style="margin-top: 12px;">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SERVER INFO PANEL (popout for logo/join) -->
  <div id="serverInfoPanel" class="panel" style="display:none; left:80px;">
    <div class="panel-header">
      <span id="serverInfoTitle"></span>
      <button class="close-btn" onclick="hidePanel('serverInfoPanel')">‚úñ</button>
    </div>
    <div class="panel-body" id="serverInfoBody"></div>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-panel" style="display: none;">
    <div class="admin-header">
      <div class="admin-profile">
        <img src="assets/profile.png" alt="Profile" />
        <div class="admin-profile-info">
          <h3>WARMONKEYX</h3>
        </div>
      </div>
      <div class="admin-tabs">
        <button class="admin-tab active" onclick="showAdminSection('homeSettings')">HOME</button>
        <button class="admin-tab" onclick="showAdminSection('serverSettingsPanel')">SERVERS</button>
        <button class="admin-tab" onclick="showAdminSection('appsSettingsPanel')">APPS</button>
      </div>
    </div>
    <div class="admin-content">
      <div id="homeSettings" class="admin-section" style="display: block;">
        <h4>Streamer Settings</h4>
        <div class="admin-field">
          <label for="streamerNameInput">Streamer Name:</label>
          <input type="text" id="streamerNameInput" placeholder="Enter your streamer name" />
        </div>
        <div class="admin-field">
          <label for="streamerBioInput">Streamer Bio:</label>
          <textarea id="streamerBioInput" placeholder="Enter your bio..." rows="4"></textarea>
        </div>
        <div class="admin-field">
          <button onclick="updateStreamerInfo()">Save Info</button>
        </div>
        <div class="admin-field">
          <label for="profileImageUpload">Upload Profile Image:</label>
          <input type="file" id="profileImageUpload" accept="image/*" onchange="updateProfileImage(event)" />
        </div>
        <div class="admin-field">
          <label for="colorPicker">Theme Color:</label>
          <input type="color" id="colorPicker" onchange="updateThemeColor(this.value)" />
        </div>
        <div class="admin-field">
          <button id="toggleLinkSettings" onclick="toggleLinkSettings()">Toggle Streamer Links</button>
        </div>
        <div id="linkSettingsContainer" style="display: none;">
          <div class="link-setting">
            <label><input type="checkbox" id="twitchCheck" /> Twitch:</label>
            <input type="url" id="twitchURL" value="https://twitch.tv/warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="youtubeCheck" /> YouTube:</label>
            <input type="url" id="youtubeURL" value="https://youtube.com/@warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="kickCheck" /> Kick:</label>
            <input type="url" id="kickURL" value="https://kick.com/warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="discordCheck" /> Discord:</label>
            <input type="url" id="discordURL" value="https://discord.gg/ANvfmFFwUS" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="tiktokCheck" /> TikTok:</label>
            <input type="url" id="tiktokURL" value="https://www.tiktok.com/@warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="donateCheck" /> Donate:</label>
            <input type="url" id="donateURL" value="https://streamelements.com/warmonkeyx/tip" />
          </div>
          <div class="admin-field">
            <button onclick="updateStreamerLinks()">Save Streamer Links</button>
          </div>
        </div>
      </div>
      <div id="serverSettingsPanel" class="admin-section" style="display: none;">
        <h3>Server Settings</h3>
        <p>Edit your server types below. Toggle visibility to show/hide them as buttons.</p>
        <div class="server-type-grid">
          <div class="server-type-card">
            <label>Server Name:</label>
            <input type="text" class="server-type-label" placeholder="e.g. GTA RP" value="GTA RP" />
            <label>Server Link:</label>
            <input type="url" class="server-type-url" placeholder="https://yourserver.com" />
            <label>Logo:</label>
            <input type="file" class="server-type-logo" accept="image/*" />
            <img class="server-type-logo-preview" src="" style="display:none; max-width:80px;"/>
            <label><input type="checkbox" class="server-type-visible" /> Show</label>
          </div>
          <div class="server-type-card">
            <label>Server Name:</label>
            <input type="text" class="server-type-label" placeholder="e.g. RedM RP" value="RedM RP" />
            <label>Server Link:</label>
            <input type="url" class="server-type-url" placeholder="https://yourserver.com" />
            <label>Logo:</label>
            <input type="file" class="server-type-logo" accept="image/*" />
            <img class="server-type-logo-preview" src="" style="display:none; max-width:80px;"/>
            <label><input type="checkbox" class="server-type-visible" /> Show</label>
          </div>
        </div>
        <button class="color-button" onclick="updateServerButtons()">Save Server Buttons</button>
      </div>
      <div id="appsSettingsPanel" class="admin-section" style="display: none;">
        <h3>Apps Settings</h3>
        <p>This section will allow you to manage which viewer-facing apps are available. Placeholder for now.</p>
        <ul>
          <li>üí° App Slot 1 - Placeholder</li>
          <li>üí° App Slot 2 - Placeholder</li>
          <li>üí° App Slot 3 - Placeholder</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- SLOT MACHINE PANEL -->
  <div id="slotPanel" class="panel" style="display: none; left:140px; top:60px; min-width:460px;">
    <div class="panel-header">
      Slot Machine
      <button class="close-btn" onclick="hidePanel('slotPanel')">‚úñ</button>
    </div>
    <div class="panel-body" style="background: transparent; overflow: visible;">
      <div id="slot-machine" class="slot-machine" style="display:block;">
        <div class="slot-header">
          <div id="slot-balance" class="slot-balance">Balance: <span id="balanceAmount">0</span> üîÆ</div>
          <button id="slot-close" class="slot-close" onclick="hidePanel('slotPanel')">&times;</button>
        </div>
        <div class="slot-reels-container">
          <canvas id="slot-winlines" width="420" height="420"></canvas>
          <div class="slot-reels">
            <div class="slot-reel" data-reel="0"></div>
            <div class="slot-reel" data-reel="1"></div>
            <div class="slot-reel" data-reel="2"></div>
          </div>
        </div>
        <div id="slot-controls" class="slot-controls">
          <button id="slot-spin" class="neon-btn">SPIN</button>
          <button id="slot-autospin" class="neon-btn">AUTO BONUS<br>100 Bits</button>
          <div id="slot-message" class="slot-message"></div>
          <div id="slot-freespins" class="slot-freespins"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- RESTORE BUTTON FOR SOLITAIRE -->
  <button id="solitaireRestoreBtn" onclick="restoreSolitaire()" style="display: none;">üÉè</button>

  <!-- SOLITAIRE APP WINDOW -->
  <div id="solitaireWindow" class="app-window" style="display: none;">
    <div class="app-window-header" onmousedown="startDrag(event)">
      <div class="app-window-title">
        <img src="assets/solitaire-icon.png" alt="Solitaire Icon" style="width: 24px; margin-right: 8px;" />
        Solitaire
      </div>
      <div class="app-window-actions">
        <button onclick="closeAppWindow()" title="Minimize">‚≠ò</button>
        <button onclick="closeAppWindow()" title="Close">‚úñ</button>
      </div>
    </div>
    <div class="app-window-body" id="solitaireGameContainer">
      <!-- Solitaire game loads here -->
    </div>
  </div>

  <!-- GAMING PANEL OVERLAY (POPUP) -->
  <div id="gamingPanelOverlay" class="overlay" style="display:none;">
    <div class="game-panel-modal">
      <button id="closeGamingPanel" class="close-btn">&times;</button>
      <h2 class="gaming-panel-title"><span class="panel-icon">üéÆ</span> Select a Game</h2>
      <div class="games-list">
        <div class="games-section">
          <h3><span class="section-emoji">üïπÔ∏è</span> <span class="section-title">Mini-Games</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-pink" id="slotsBtn"><span class="btn-icon">üçí</span> Slots</button>
            <button class="game-list-btn neon-btn neon-cyan" id="diceBtn"><span class="btn-icon">üé≤</span> Dice Roll</button>
            <button class="game-list-btn neon-btn neon-gradient" id="wheelBtn"><span class="btn-icon">‚ùÑÔ∏è</span> Wheel Spin</button>
          </div>
        </div>
        <div class="games-section">
          <h3><span class="section-emoji">üé§</span> <span class="section-title">Interactions</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-cyan" id="soundboardBtn"><span class="btn-icon">üéº</span> Soundboard</button>
            <button class="game-list-btn neon-btn neon-gradient" id="screenAnimBtn"><span class="btn-icon">üí•</span> Screen Animations</button>
            <button class="game-list-btn neon-btn neon-pink" id="pollsBtn"><span class="btn-icon">üó≥Ô∏è</span> Polls</button>
          </div>
        </div>
        <div class="games-section">
          <h3><span class="section-emoji">‚öîÔ∏è</span> <span class="section-title">Battle / PvP</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-cyan" id="battleRoyaleBtn"><span class="btn-icon">üèÜ</span> Bits Battle Royale</button>
            <button class="game-list-btn neon-btn neon-pink" id="bossFightBtn"><span class="btn-icon">üëπ</span> Boss Fight</button>
          </div>
        </div>
        <div class="games-section">
          <h3><span class="section-emoji">üíé</span> <span class="section-title">Official Extensions</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-cyan" id="crowdControlBtn"><span class="btn-icon">ü™Ñ</span> Crowd Control</button>
            <button class="game-list-btn neon-btn neon-pink" id="soundAlertsBtn"><span class="btn-icon">üîî</span> Sound Alerts</button>
            <button class="game-list-btn neon-btn neon-gradient" id="bitArcadeBtn"><span class="btn-icon">üïπÔ∏è</span> Bit Arcade</button>
            <button class="game-list-btn neon-btn neon-cyan" id="kappaCasinoBtn"><span class="btn-icon">üé∞</span> Kappa Casino</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- STATS APP WINDOW -->
  <div id="statsWindow" class="app-window" style="display: none; position: absolute; top: 200px; left: 300px;">
    <div class="app-window-header" onmousedown="startDrag(event)">
      <span>üìä Stats</span>
      <div style="margin-left: auto; display: flex; gap: 10px;">
        <button onclick="closeStatsWindow()" style="color: red;">‚≠ò</button>
        <button onclick="closeStatsWindow()">‚úñ</button>
      </div>
    </div>
    <div class="custom-stats-panel" id="customStatsPanel">
      <h4>Choose Your Stats</h4>
      <form id="statsPrefsForm">
        <label><input type="checkbox" name="followage" /> Followed Since</label><br>
        <label><input type="checkbox" name="channelPoints" /> Channel Points</label><br>
        <label><input type="checkbox" name="messagesSent" /> Messages Sent</label><br>
        <label><input type="checkbox" name="badges" /> Badges</label><br>
        <label><input type="checkbox" name="subStatus" /> Sub Status</label><br>
        <label><input type="checkbox" name="viewerNumber" /> Viewer Number</label><br>
        <button type="submit">Save & Show</button>
        <button type="button" onclick="closeCustomStats()">Cancel</button>
      </form>
    </div>
    <div class="app-window-body" id="statsAppContainer" style="background-color: #000; color: #0f0; font-family: 'Fira Mono', monospace;">
      <div id="welcomeMessage" style="margin-bottom: 12px;"></div>
      <div id="cmdTerminal"></div>
      <div style="margin-top: 12px;">
        <button onclick="showBasicStats()">Get Stats</button>
        <button onclick="openCustomStats()">Custom Stats</button>
      </div>
    </div>
  </div>

  <!-- DOCK BAR -->
  <div id="dockBar">
    <button class="dock-btn" data-panel="streamInfoPanel" title="Stream Info">üé¨</button>
    <button class="dock-btn" data-panel="chatPanel" title="Chat">üí¨</button>
    <button class="dock-btn" data-panel="pollPanel" title="Polls">üìä</button>
    <button class="dock-btn" data-panel="linksPanel" title="Links">üîó</button>
    <button class="dock-btn" data-panel="freeModePanel" id="freeModeDockBtn" title="FreeMode">üñ•Ô∏è</button>
    <button id="customizeToggle" title="Customize Layout">üõ†Ô∏è</button>
  </div>

  <!-- PANELS -->
  <div id="streamInfoPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Stream Info <button class="close-btn" data-panel="streamInfoPanel">‚úñ</button></div>
    <div class="panel-body" id="streamInfoBody"></div>
  </div>

  <div id="chatPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Chat <button class="close-btn" data-panel="chatPanel">‚úñ</button></div>
    <div class="panel-body" id="chatBody">(Chat goes here)</div>
  </div>

  <div id="pollPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Polls <button class="close-btn" data-panel="pollPanel">‚úñ</button></div>
    <div class="panel-body" id="pollBody">(Polls go here)</div>
  </div>

  <div id="linksPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Links <button class="close-btn" data-panel="linksPanel">‚úñ</button></div>
    <div class="panel-body">
      <ul class="links-list" id="popoutLinksList">
        <!-- Links will be dynamically inserted here -->
      </ul>
    </div>
  </div>

  <div id="freeModePanel" class="panel" style="display:none; left:140px; top:80px; min-width:360px;">
    <div class="panel-header" onmousedown="startDrag(event)">FreeMode
      <button class="close-btn" data-panel="freeModePanel">‚úñ</button>
    </div>
    <div class="panel-body" id="freeModeBody">
      <div style="margin-bottom:10px;">Drag and resize this panel! Click "Show Stream" below to open your Twitch stream.</div>
      <button id="showTwitchEmbedBtn" onclick="toggleTwitchEmbed()" style="margin-bottom:8px;">Show Stream</button>
      <div id="twitchEmbedPanel" style="display:none; resize:both; overflow:auto; min-width:320px; min-height:180px; border-radius:12px; box-shadow:0 0 8px #00fff7;"></div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
// ==================
// PANEL UTILITIES
// ==================
function showPanel(panelId) {
  document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
  const panel = document.getElementById(panelId);
  if (panel) panel.style.display = 'block';
}
function hidePanel(panelId) {
  const panel = document.getElementById(panelId);
  if (panel) panel.style.display = 'none';
}

// ===============
// INFO BUBBLE
// ===============
function toggleCard() {
  const card = document.getElementById("infoCard");
  if (!card) return;
  card.style.display = card.style.display === 'flex' ? 'none' : 'flex';
  if (card.style.display === 'flex') card.scrollTop = 0;
}

// ===============
// TABS (INFO CARD)
// ===============
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
  const tab = document.getElementById(tabId);
  if (tab) tab.style.display = 'flex';
}

// ===============
// ADMIN PANEL
// ===============
function toggleAdminPanel() {
  const panel = document.querySelector('.admin-panel');
  if (panel) panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
}
function showAdminSection(sectionId) {
  document.querySelectorAll('.admin-section').forEach(sec => sec.style.display = 'none');
  const sec = document.getElementById(sectionId);
  if (sec) sec.style.display = 'block';
  document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
  const btn = Array.from(document.querySelectorAll('.admin-tab')).find(
    tab => tab.getAttribute('onclick') && tab.getAttribute('onclick').includes(sectionId)
  );
  if (btn) btn.classList.add('active');
}

// ===============
// STREAMER LINKS & ADMIN PANEL LOGIC
// ===============
function toggleLinkSettings() {
  const c = document.getElementById('linkSettingsContainer');
  if (c) c.style.display = (c.style.display === 'block') ? 'none' : 'block';
}
function updateStreamerLinks() {
  // Save links (this is a placeholder, actual saving logic may differ)
  alert('Streamer links updated!');
}
function updateStreamerInfo() {
  // Save info (this is a placeholder)
  alert('Streamer info updated!');
}
function updateProfileImage(event) {
  // Set new profile image preview
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    document.querySelectorAll('img[alt="Profile"]').forEach(img => img.src = e.target.result);
  };
  reader.readAsDataURL(file);
}
function updateThemeColor(val) {
  document.documentElement.style.setProperty('--accent-color', val);
  document.documentElement.style.setProperty('--gradient-start', val);
}

// ===============
// DOCK VISIBILITY PREFS
// ===============
function loadDockVisibilityPrefs() {
  const prefs = JSON.parse(localStorage.getItem("dockVisibilityPrefs") || "{}");
  document.querySelectorAll('.dock-toggle').forEach(toggle => {
    const dockId = toggle.getAttribute('data-dock');
    toggle.checked = prefs[dockId] !== false;
    updateDockButtonVisibility(dockId, toggle.checked);
    toggle.addEventListener('change', function () {
      updateDockButtonVisibility(dockId, toggle.checked);
      saveDockVisibilityPrefs();
    });
  });
}
function updateDockButtonVisibility(dockId, show) {
  const btn = dockId === "customizeToggle"
    ? document.getElementById("customizeToggle")
    : document.querySelector('.dock-btn[data-panel="'+dockId+'"]');
  if (btn) btn.style.display = show ? "" : "none";
}
function saveDockVisibilityPrefs() {
  const prefs = {};
  document.querySelectorAll('.dock-toggle').forEach(toggle => {
    const dockId = toggle.getAttribute('data-dock');
    prefs[dockId] = toggle.checked;
  });
  localStorage.setItem("dockVisibilityPrefs", JSON.stringify(prefs));
}
window.addEventListener("DOMContentLoaded", loadDockVisibilityPrefs);

// ===============
// GAMING PANEL LOGIC (SHOW/HIDE)
// ===============
document.getElementById('gamingAppIcon').onclick = function() {
  document.getElementById('gamingPanelOverlay').style.display = 'flex';
};
document.getElementById('closeGamingPanel').onclick = function() {
  document.getElementById('gamingPanelOverlay').style.display = 'none';
};
document.getElementById('gamingPanelOverlay').onclick = function(e) {
  if (e.target === document.getElementById('gamingPanelOverlay')) {
    document.getElementById('gamingPanelOverlay').style.display = 'none';
  }
};

// ===============
// SLOT MACHINE PANEL LOGIC
// ===============
document.getElementById('slotsBtn').onclick = function() {
  document.getElementById('gamingPanelOverlay').style.display = 'none';
  showPanel('slotPanel');
  if (typeof initSlotMachine === "function") initSlotMachine();
};
document.getElementById('slot-close').onclick = function() {
  hidePanel('slotPanel');
  if (typeof initSlotMachine === "function") initSlotMachine();
};

// ===============
// SLOT MACHINE FUNCTIONALITY
// ===============
const SLOT_SYMBOLS = [
  { img: 'assets/slots1.png', name: "Ember" },
  { img: 'assets/slots2.png', name: "Streamer Coin" },
  { img: 'assets/slots3.png', name: "GG" },
  { img: 'assets/slots4.png', name: "Streamer Face" },
  { img: 'assets/slots5.png', name: "Neon Star" },
  { img: 'assets/slots6.png', name: "Twitch Coin" },
  { img: 'assets/slots7.png', name: "Arcade" },
  { img: 'assets/slots8.png', name: "Jackpot" },
  { img: 'assets/slots9.png', name: "FREE SPIN" }
];
let slotBalance = 0;
let freeSpins = 0;
let isSpinning = false;
const reels = [0, 1, 2].map(i => document.querySelector(`.slot-reel[data-reel="${i}"]`));
const spinBtn = document.getElementById('slot-spin');
const autoBtn = document.getElementById('slot-autospin');
const msgEl = document.getElementById('slot-message');
const fsEl = document.getElementById('slot-freespins');
const balEl = document.getElementById('balanceAmount');
const winlinesCanvas = document.getElementById('slot-winlines');
const ctx = winlinesCanvas.getContext('2d');

function randSymbol() {
  return Math.floor(Math.random() * SLOT_SYMBOLS.length);
}
function animateReel(reelIdx, result, duration = 900) {
  return new Promise(resolve => {
    const reel = reels[reelIdx];
    const steps = 18 + Math.floor(Math.random() * 6);
    let pos = 0;
    let lastTime = performance.now();
    reel.innerHTML = '';
    let queue = [];
    for (let i = 0; i < steps; i++) {
      const idx = randSymbol();
      queue.push(idx);
      const el = document.createElement('div');
      el.className = 'slot-symbol';
      el.innerHTML = `<img src="${SLOT_SYMBOLS[idx].img}" alt="">`;
      reel.appendChild(el);
    }
    for (let i = 0; i < 3; i++) {
      queue.push(result[i]);
      const el = document.createElement('div');
      el.className = 'slot-symbol';
      el.innerHTML = `<img src="${SLOT_SYMBOLS[result[i]].img}" alt="">`;
      reel.appendChild(el);
    }
    let offset = 0;
    function animate(time) {
      const dt = Math.min(24, time - lastTime);
      lastTime = time;
      offset += dt * (420 / duration);
      reel.style.transform = `translateY(${-offset}px)`;
      if (offset < (steps * 140)) {
        requestAnimationFrame(animate);
      } else {
        reel.innerHTML = '';
        for (let i = 0; i < 3; i++) {
          const idx = result[i];
          const el = document.createElement('div');
          el.className = 'slot-symbol';
          el.innerHTML = `<img src="${SLOT_SYMBOLS[idx].img}" alt="">`;
          reel.appendChild(el);
        }
        reel.style.transform = 'translateY(0)';
        resolve();
      }
    }
    requestAnimationFrame(animate);
  });
}
function getSpinResult() {
  return [
    [randSymbol(), randSymbol(), randSymbol()],
    [randSymbol(), randSymbol(), randSymbol()],
    [randSymbol(), randSymbol(), randSymbol()]
  ];
}
function drawWinLines(winLines) {
  ctx.clearRect(0, 0, winlinesCanvas.width, winlinesCanvas.height);
  winLines.forEach(line => {
    ctx.save();
    ctx.strokeStyle = line.color || "#ff0";
    ctx.shadowColor = line.color || "#ff0";
    ctx.shadowBlur = 12;
    ctx.lineWidth = 8;
    ctx.beginPath();
    const cell = (row, col) => [col * 140 + 70, row * 140 + 70];
    line.pts.forEach((pt, i) => {
      const [x, y] = cell(pt[0], pt[1]);
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
    ctx.restore();
  });
}
function checkWin(resultGrid) {
  const rows = [0,1,2].map(r => [resultGrid[0][r], resultGrid[1][r], resultGrid[2][r]]);
  const cols = resultGrid;
  const diags = [
    [resultGrid[0][0], resultGrid[1][1], resultGrid[2][2]],
    [resultGrid[0][2], resultGrid[1][1], resultGrid[2][0]]
  ];
  let winLines = [];
  let bigWin = false;
  let freeSpinCount = 0;
  let winSymbols = [];
  for (let i = 0; i < 3; i++) {
    if (rows[i][0] === rows[i][1] && rows[i][1] === rows[i][2]) {
      winLines.push({ pts: [[i,0],[i,1],[i,2]], color: "#ff0" });
      winSymbols.push(SLOT_SYMBOLS[rows[i][0]].name);
      if (rows[i][0] === 8) bigWin = true;
    }
    if (cols[i][0] === cols[i][1] && cols[i][1] === cols[i][2]) {
      winLines.push({ pts: [[0,i],[1,i],[2,i]], color: "#0ff" });
      winSymbols.push(SLOT_SYMBOLS[cols[i][0]].name);
      if (cols[i][0] === 8) bigWin = true;
    }
  }
  if (diags[0][0] === diags[0][1] && diags[0][1] === diags[0][2]) {
    winLines.push({ pts: [[0,0],[1,1],[2,2]], color: "#ff00ea" });
    winSymbols.push(SLOT_SYMBOLS[diags[0][0]].name);
    if (diags[0][0] === 8) bigWin = true;
  }
  if (diags[1][0] === diags[1][1] && diags[1][1] === diags[1][2]) {
    winLines.push({ pts: [[2,0],[1,1],[0,2]], color: "#ffae00" });
    winSymbols.push(SLOT_SYMBOLS[diags[1][0]].name);
    if (diags[1][0] === 8) bigWin = true;
  }
  for (let c = 0; c < 3; c++) for (let r = 0; r < 3; r++) if (resultGrid[c][r] === 8) freeSpinCount++;
  return { winLines, bigWin, freeSpinCount, winSymbols };
}
async function spinSlots(isBonus = false) {
  if (isSpinning) return;
  isSpinning = true;
  spinBtn.disabled = true;
  autoBtn.disabled = true;
  msgEl.textContent = '';
  drawWinLines([]);
  let resultGrid = getSpinResult();
  await Promise.all([0,1,2].map(i => animateReel(i, resultGrid[i])));
  const { winLines, bigWin, freeSpinCount, winSymbols } = checkWin(resultGrid);
  drawWinLines(winLines);
  if (freeSpinCount >= 5) {
    freeSpins += 10;
    fsEl.textContent = `FREE SPINS +10!`;
    msgEl.textContent = "üéâ BONUS! 10 Free Spins Awarded!";
  } else if (winLines.length > 0) {
    msgEl.textContent = `WIN! ${winSymbols.join(", ")}`;
    if (bigWin) msgEl.textContent = "üî• BIG WIN! üî•";
  } else {
    msgEl.textContent = "No win. Try again!";
    fsEl.textContent = '';
  }
  if (freeSpins > 0) {
    freeSpins--;
    fsEl.textContent = `Free Spins: ${freeSpins}`;
    setTimeout(() => spinSlots(false), 1200);
  } else {
    fsEl.textContent = '';
    spinBtn.disabled = false;
    autoBtn.disabled = false;
    isSpinning = false;
  }
}
spinBtn.onclick = async () => { await spinSlots(false); };
autoBtn.onclick = async () => { await spinSlots(true); };
function initSlotMachine() {
  msgEl.textContent = '';
  fsEl.textContent = '';
  balEl.textContent = slotBalance;
  reels.forEach(r => r.innerHTML = '');
  drawWinLines([]);
  spinBtn.disabled = false;
  autoBtn.disabled = false;
  isSpinning = false;
}

// ===============
// ADDITIONAL: Other App Launchers (Solitaire/Stats placeholders)
// ===============
function launchSolitaireApp() {
  document.getElementById("solitaireWindow").style.display = "flex";
}
function closeAppWindow() {
  document.getElementById("solitaireWindow").style.display = "none";
}
function launchStatsApp() {
  document.getElementById("statsWindow").style.display = "flex";
}
function closeStatsWindow() {
  document.getElementById("statsWindow").style.display = "none";
}
function restoreSolitaire() {
  document.getElementById("solitaireWindow").style.display = "flex";
}

// ===============
// TABS: Hide/Show Panels via Dock
// ===============
document.querySelectorAll('.dock-btn').forEach(btn => {
  btn.onclick = function() {
    const panelId = btn.getAttribute('data-panel');
    showPanel(panelId);
  };
});
document.querySelectorAll('.panel .close-btn').forEach(btn => {
  btn.onclick = function() {
    const panelId = btn.getAttribute('data-panel');
    hidePanel(panelId);
  };
});

// ===============
// CUSTOMIZE TOGGLE
// ===============
document.getElementById('customizeToggle').onclick = function() {
  // Example logic for a customize mode, can be expanded as needed
  alert("Customize mode coming soon!");
};

// ===============
// APPS VISIBILITY CONTROLS
// ===============
function toggleAppsVisibilityControls() {
  const controls = document.querySelector('.apps-visibility-controls');
  if (controls) {
    controls.style.display = (controls.style.display === 'none' || controls.style.display === '') ? 'block' : 'none';
  }
}

// ===============
// DUMMY: Stats/Command Panel (expand as needed)
// ===============
function openCustomStats() {
  document.getElementById('customStatsPanel').style.opacity = 1;
  document.getElementById('customStatsPanel').style.pointerEvents = 'auto';
}
function closeCustomStats() {
  document.getElementById('customStatsPanel').style.opacity = 0;
  document.getElementById('customStatsPanel').style.pointerEvents = 'none';
}
function showBasicStats() {
  document.getElementById('cmdTerminal').innerText = "Stats loaded! (Demo)";
}

// ===============
// DRAGGING WINDOWS (Solitaire/Stats)
// ===============
let dragData = null;
function startDrag(e) {
  const win = e.target.closest('.app-window');
  if (!win) return;
  dragData = {
    win,
    startX: e.clientX,
    startY: e.clientY,
    origX: win.offsetLeft,
    origY: win.offsetTop
  };
  document.onmousemove = dragMove;
  document.onmouseup = stopDrag;
}
function dragMove(e) {
  if (!dragData) return;
  const dx = e.clientX - dragData.startX;
  const dy = e.clientY - dragData.startY;
  dragData.win.style.left = (dragData.origX + dx) + "px";
  dragData.win.style.top = (dragData.origY + dy) + "px";
}
function stopDrag(e) {
  dragData = null;
  document.onmousemove = null;
  document.onmouseup = null;
}

// ===============
// TWITCH EMBED PANEL (Toggle Show/Hide)
// ===============
function toggleTwitchEmbed() {
  const panel = document.getElementById('twitchEmbedPanel');
  if (panel.style.display === 'block') {
    panel.style.display = 'none';
    panel.innerHTML = '';
  } else {
    panel.style.display = 'block';
    panel.innerHTML = '<iframe src="https://player.twitch.tv/?channel=warmonkeyx&parent=localhost" frameborder="0" allowfullscreen="true"></iframe>';
  }
}
  </script>
</body>
</html>
