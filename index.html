<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Streamer Info</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- INFO BUBBLE AND MAIN NAV -->
  <div class="info-bubble">
    <div class="info-button" onclick="toggleCard()">i</div>
    <div class="info-card" id="infoCard">
      <nav class="top-nav internal-nav">
        <button onclick="showTab('homeTab')">HOME</button>
        <button onclick="showTab('serversTab')">SERVERS</button>
        <button onclick="showTab('appsTab')">APPS</button>
        <div class="settings-icon" onclick="toggleAdminPanel()">âš™ï¸</div>
      </nav>

      <div class="tab-content" id="homeTab">
        <img src="assets/profile.png" alt="Profile" />
        <h3>WARMONKEYX</h3>
        <p>
          Witness the madness unfold under the freeway. From explosive dumpster deals and sketchy science experiments to mysterious rituals beneath the full moon â€” WarmonkeyX delivers raw, unscripted RP that blends chaos with character-driven lore.
          <br><br>
          If you crave unpredictable storylines, gritty humor, and explosive moments, this is your new religion.
        </p>
        <div class="streamer-links" id="mainStreamerLinks">
          <!-- Links dynamically filled by JS -->
        </div>
      </div>

      <div class="tab-content" id="serversTab" style="display: none;">
        <h3>Servers</h3>
        <p>Select your server type:</p>
        <div class="internal-nav" id="serverTypeButtons">
          <!-- Server type buttons dynamically generated by JS -->
        </div>
      </div>

      <div class="tab-content" id="gtaTab" style="display: none;">
        <h3>GTA RP Server</h3>
        <div id="gtaServerPanel"></div>
      </div>

      <div class="tab-content" id="redmTab" style="display: none;">
        <h3>RedM RP Server</h3>
        <div id="redmServerPanel"></div>
      </div>

      <div class="tab-content" id="appsTab" style="display: none;"> 
        <h3>Apps</h3>
        <p>Select a viewer app to open:</p>
        <div class="app-grid">
          <div class="app-icon" onclick="launchSolitaireApp()">
            <span>ğŸƒ</span>
            <p>Solitaire</p>
          </div>
          <div class="app-icon" onclick="launchStatsApp()">
            <span>ğŸ“Š</span>
            <p>Stats</p>
          </div>
          <div class="app-icon"><span>ğŸ“±</span><p>Mobile</p></div>
          <!-- Gaming App Icon with Popup -->
          <div class="app-icon" id="gamingAppIcon">
            <span>ğŸ®</span>
            <p>Gaming</p>
          </div>
          <div class="app-icon" id="streamingAppIcon" onclick="toggleAppsVisibilityControls()">
            <span>ğŸ¥</span>
            <p>Streaming</p>
          </div>
          <div class="app-icon"><span>ğŸ§ª</span><p>Experiments</p></div>
        </div>
        <div class="apps-visibility-controls" style="display:none;">
          <h4>Show/Hide Dock Buttons</h4>
          <label><input type="checkbox" class="dock-toggle" data-dock="streamInfoPanel" /> Stream Info</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="chatPanel" /> Chat</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="pollPanel" /> Polls</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="linksPanel" /> Links</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="" /> Links</label><br>
          <label><input type="checkbox" class="dock-toggle" data-dock="customizeToggle" /> Customize</label><br>
          <button id="saveDockVisibility" style="margin-top: 12px;">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SERVER INFO PANEL (popout for logo/join) -->
  <div id="serverInfoPanel" class="panel" style="display:none; left:80px;">
    <div class="panel-header">
      <span id="serverInfoTitle"></span>
      <button class="close-btn" onclick="hidePanel('serverInfoPanel')">âœ–</button>
    </div>
    <div class="panel-body" id="serverInfoBody"></div>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-panel" style="display: none;">
    <div class="admin-header">
      <div class="admin-profile">
        <img src="assets/profile.png" alt="Profile" />
        <div class="admin-profile-info">
          <h3>WARMONKEYX</h3>
        </div>
      </div>
      <div class="admin-tabs">
        <button class="admin-tab active" onclick="showAdminSection('homeSettings')">HOME</button>
        <button class="admin-tab" onclick="showAdminSection('serverSettingsPanel')">SERVERS</button>
        <button class="admin-tab" onclick="showAdminSection('appsSettingsPanel')">APPS</button>
      </div>
    </div>
    <div class="admin-content">
      <div id="homeSettings" class="admin-section" style="display: block;">
        <h4>Streamer Settings</h4>
        <div class="admin-field">
          <label for="streamerNameInput">Streamer Name:</label>
          <input type="text" id="streamerNameInput" placeholder="Enter your streamer name" />
        </div>
        <div class="admin-field">
          <label for="streamerBioInput">Streamer Bio:</label>
          <textarea id="streamerBioInput" placeholder="Enter your bio..." rows="4"></textarea>
        </div>
        <div class="admin-field">
          <button onclick="updateStreamerInfo()">Save Info</button>
        </div>
        <div class="admin-field">
          <label for="profileImageUpload">Upload Profile Image:</label>
          <input type="file" id="profileImageUpload" accept="image/*" onchange="updateProfileImage(event)" />
        </div>
        <div class="admin-field">
          <label for="colorPicker">Theme Color:</label>
          <input type="color" id="colorPicker" onchange="updateThemeColor(this.value)" />
        </div>
        <div class="admin-field">
          <button id="toggleLinkSettings" onclick="toggleLinkSettings()">Toggle Streamer Links</button>
        </div>
        <div id="linkSettingsContainer" style="display: none;">
          <div class="link-setting">
            <label><input type="checkbox" id="twitchCheck" /> Twitch:</label>
            <input type="url" id="twitchURL" value="https://twitch.tv/warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="youtubeCheck" /> YouTube:</label>
            <input type="url" id="youtubeURL" value="https://youtube.com/@warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="kickCheck" /> Kick:</label>
            <input type="url" id="kickURL" value="https://kick.com/warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="discordCheck" /> Discord:</label>
            <input type="url" id="discordURL" value="https://discord.gg/ANvfmFFwUS" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="tiktokCheck" /> TikTok:</label>
            <input type="url" id="tiktokURL" value="https://www.tiktok.com/@warmonkeyx" />
          </div>
          <div class="link-setting">
            <label><input type="checkbox" id="donateCheck" /> Donate:</label>
            <input type="url" id="donateURL" value="https://streamelements.com/warmonkeyx/tip" />
          </div>
          <div class="admin-field">
            <button onclick="updateStreamerLinks()">Save Streamer Links</button>
          </div>
        </div>
      </div>
      <div id="serverSettingsPanel" class="admin-section" style="display: none;">
        <h3>Server Settings</h3>
        <p>Edit your server types below. Toggle visibility to show/hide them as buttons.</p>
        <div class="server-type-grid">
          <!-- Slot 1 -->
          <div class="server-type-card">
            <label>Server Name:</label>
            <input type="text" class="server-type-label" placeholder="e.g. GTA RP" value="GTA RP" />
            <label>Server Link:</label>
            <input type="url" class="server-type-url" placeholder="https://yourserver.com" />
            <label>Logo:</label>
            <input type="file" class="server-type-logo" accept="image/*" />
            <img class="server-type-logo-preview" src="" style="display:none; max-width:80px;"/>
            <label><input type="checkbox" class="server-type-visible" /> Show</label>
          </div>
          <!-- Slot 2 -->
          <div class="server-type-card">
            <label>Server Name:</label>
            <input type="text" class="server-type-label" placeholder="e.g. RedM RP" value="RedM RP" />
            <label>Server Link:</label>
            <input type="url" class="server-type-url" placeholder="https://yourserver.com" />
            <label>Logo:</label>
            <input type="file" class="server-type-logo" accept="image/*" />
            <img class="server-type-logo-preview" src="" style="display:none; max-width:80px;"/>
            <label><input type="checkbox" class="server-type-visible" /> Show</label>
          </div>
        </div>
        <button class="color-button" onclick="updateServerButtons()">Save Server Buttons</button>
      </div>
      <div id="appsSettingsPanel" class="admin-section" style="display: none;">
        <h3>Apps Settings</h3>
        <p>This section will allow you to manage which viewer-facing apps are available. Placeholder for now.</p>
        <ul>
          <li>ğŸ’¡ App Slot 1 - Placeholder</li>
          <li>ğŸ’¡ App Slot 2 - Placeholder</li>
          <li>ğŸ’¡ App Slot 3 - Placeholder</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- RESTORE BUTTON FOR SOLITAIRE -->
  <button id="solitaireRestoreBtn" onclick="restoreSolitaire()" style="display: none;">ğŸƒ</button>

  <!-- SOLITAIRE APP WINDOW -->
  <div id="solitaireWindow" class="app-window" style="display: none;">
    <div class="app-window-header" onmousedown="startDrag(event)">
      <div class="app-window-title">
        <img src="assets/solitaire-icon.png" alt="Solitaire Icon" style="width: 24px; margin-right: 8px;" />
        Solitaire
      </div>
      <div class="app-window-actions">
        <button onclick="closeAppWindow()" title="Minimize">â­˜</button>
        <button onclick="closeAppWindow()" title="Close">âœ–</button>
      </div>
    </div>
    <div class="app-window-body" id="solitaireGameContainer">
      <!-- Solitaire game loads here -->
    </div>
  </div>

  <!-- GAMING PANEL OVERLAY (POPUP) -->
  <div id="gamingPanelOverlay" class="overlay" style="display:none;">
    <div class="game-panel-modal">
      <button id="closeGamingPanel" class="close-btn">&times;</button>
      <h2 class="gaming-panel-title"><span class="panel-icon">ğŸ®</span> Select a Game</h2>
      <div class="games-list">
        <!-- Mini-Games -->
        <div class="games-section">
          <h3><span class="section-emoji">ğŸ•¹ï¸</span> <span class="section-title">Mini-Games</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-pink" id="slotsBtn"><span class="btn-icon">ğŸ’</span> Slots</button>
            <button class="game-list-btn neon-btn neon-cyan" id="diceBtn"><span class="btn-icon">ğŸ²</span> Dice Roll</button>
            <button class="game-list-btn neon-btn neon-gradient" id="wheelBtn"><span class="btn-icon">â„ï¸</span> Wheel Spin</button>
          </div>
        </div>
        <!-- Interactions -->
        <div class="games-section">
          <h3><span class="section-emoji">ğŸ¤</span> <span class="section-title">Interactions</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-cyan" id="soundboardBtn"><span class="btn-icon">ğŸ¼</span> Soundboard</button>
            <button class="game-list-btn neon-btn neon-gradient" id="screenAnimBtn"><span class="btn-icon">ğŸ’¥</span> Screen Animations</button>
            <button class="game-list-btn neon-btn neon-pink" id="pollsBtn"><span class="btn-icon">ğŸ—³ï¸</span> Polls</button>
          </div>
        </div>
        <!-- Battle/PvP -->
        <div class="games-section">
          <h3><span class="section-emoji">âš”ï¸</span> <span class="section-title">Battle / PvP</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-cyan" id="battleRoyaleBtn"><span class="btn-icon">ğŸ†</span> Bits Battle Royale</button>
            <button class="game-list-btn neon-btn neon-pink" id="bossFightBtn"><span class="btn-icon">ğŸ‘¹</span> Boss Fight</button>
          </div>
        </div>
        <!-- Official Extensions -->
        <div class="games-section">
          <h3><span class="section-emoji">ğŸ’</span> <span class="section-title">Official Extensions</span></h3>
          <div class="games-row">
            <button class="game-list-btn neon-btn neon-cyan" id="crowdControlBtn"><span class="btn-icon">ğŸª„</span> Crowd Control</button>
            <button class="game-list-btn neon-btn neon-pink" id="soundAlertsBtn"><span class="btn-icon">ğŸ””</span> Sound Alerts</button>
            <button class="game-list-btn neon-btn neon-gradient" id="bitArcadeBtn"><span class="btn-icon">ğŸ•¹ï¸</span> Bit Arcade</button>
            <button class="game-list-btn neon-btn neon-cyan" id="kappaCasinoBtn"><span class="btn-icon">ğŸ°</span> Kappa Casino</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SLOT MACHINE APP WINDOW (hidden by default) -->
  <div id="slot-machine" class="slot-machine" style="display:none;">
    <div class="slot-header">
      <div id="slot-balance" class="slot-balance">Balance: <span id="balanceAmount">0</span> ğŸ”®</div>
      <button id="slot-close" class="slot-close">&times;</button>
    </div>
    <div class="slot-reels-container">
      <canvas id="slot-winlines" width="420" height="420"></canvas>
      <div class="slot-reels">
        <div class="slot-reel" data-reel="0"></div>
        <div class="slot-reel" data-reel="1"></div>
        <div class="slot-reel" data-reel="2"></div>
      </div>
    </div>
    <div id="slot-controls" class="slot-controls">
      <button id="slot-spin" class="neon-btn">SPIN</button>
      <button id="slot-autospin" class="neon-btn">AUTO BONUS<br>100 Bits</button>
      <div id="slot-message" class="slot-message"></div>
      <div id="slot-freespins" class="slot-freespins"></div>
    </div>
  </div>
  <!-- END SLOT MACHINE -->
<!-- SOLITAIRE APP WINDOW -->
  <div id="solitaireWindow" class="app-window" style="display: none;">
    <div class="app-window-header" onmousedown="startDrag(event)">
      <div class="app-window-title">
        <img src="assets/solitaire-icon.png" alt="Solitaire Icon" style="width: 24px; margin-right: 8px;" />
        Solitaire
      </div>
      <div class="app-window-actions">
        <button onclick="closeAppWindow()" title="Minimize">â­˜</button>
        <button onclick="closeAppWindow()" title="Close">âœ–</button>
      </div>
    </div>
    <div class="app-window-body" id="solitaireGameContainer">
      <!-- Solitaire game loads here -->
    </div>
  </div>

  <!-- GAMING PANEL OVERLAY (POPUP) -->
 <!-- Neon Gaming Panel Overlay: Final Polished Version -->
<div id="gamingPanelOverlay" class="overlay" style="display:none;">
  <div class="game-panel-modal">
    <button id="closeGamingPanel" class="close-btn">&times;</button>
    <h2 class="gaming-panel-title"><span class="panel-icon">ğŸ®</span> Select a Game</h2>
    <div class="games-list">
      <!-- Mini-Games -->
      <div class="games-section">
        <h3><span class="section-emoji">ğŸ•¹ï¸</span> <span class="section-title">Mini-Games</span></h3>
        <div class="games-row">
          <button class="game-list-btn neon-btn neon-pink" id="slotsBtn"><span class="btn-icon">ğŸ’</span> Slots</button>
          <button class="game-list-btn neon-btn neon-cyan" id="diceBtn"><span class="btn-icon">ğŸ²</span> Dice Roll</button>
          <button class="game-list-btn neon-btn neon-gradient" id="wheelBtn"><span class="btn-icon">â„ï¸</span> Wheel Spin</button>
        </div>
      </div>
      <!-- Interactions -->
      <div class="games-section">
        <h3><span class="section-emoji">ğŸ¤</span> <span class="section-title">Interactions</span></h3>
        <div class="games-row">
          <button class="game-list-btn neon-btn neon-cyan" id="soundboardBtn"><span class="btn-icon">ğŸ¼</span> Soundboard</button>
          <button class="game-list-btn neon-btn neon-gradient" id="screenAnimBtn"><span class="btn-icon">ğŸ’¥</span> Screen Animations</button>
          <button class="game-list-btn neon-btn neon-pink" id="pollsBtn"><span class="btn-icon">ğŸ—³ï¸</span> Polls</button>
        </div>
      </div>
      <!-- Battle/PvP -->
      <div class="games-section">
        <h3><span class="section-emoji">âš”ï¸</span> <span class="section-title">Battle / PvP</span></h3>
        <div class="games-row">
          <button class="game-list-btn neon-btn neon-cyan" id="battleRoyaleBtn"><span class="btn-icon">ğŸ†</span> Bits Battle Royale</button>
          <button class="game-list-btn neon-btn neon-pink" id="bossFightBtn"><span class="btn-icon">ğŸ‘¹</span> Boss Fight</button>
        </div>
      </div>
      <!-- Official Extensions -->
      <div class="games-section">
        <h3><span class="section-emoji">ğŸ’</span> <span class="section-title">Official Extensions</span></h3>
        <div class="games-row">
          <button class="game-list-btn neon-btn neon-cyan" id="crowdControlBtn"><span class="btn-icon">ğŸª„</span> Crowd Control</button>
          <button class="game-list-btn neon-btn neon-pink" id="soundAlertsBtn"><span class="btn-icon">ğŸ””</span> Sound Alerts</button>
          <button class="game-list-btn neon-btn neon-gradient" id="bitArcadeBtn"><span class="btn-icon">ğŸ•¹ï¸</span> Bit Arcade</button>
          <button class="game-list-btn neon-btn neon-cyan" id="kappaCasinoBtn"><span class="btn-icon">ğŸ°</span> Kappa Casino</button>
        </div>
      </div>
    </div>
  </div>
</div>
  <!-- STATS APP WINDOW -->
  <div id="statsWindow" class="app-window" style="display: none; position: absolute; top: 200px; left: 300px;">
    <div class="app-window-header" onmousedown="startDrag(event)">
      <span>ğŸ“Š Stats</span>
      <div style="margin-left: auto; display: flex; gap: 10px;">
        <button onclick="closeStatsWindow()" style="color: red;">â­˜</button>
        <button onclick="closeStatsWindow()">âœ–</button>
      </div>
    </div>
    <!-- Custom Stats Panel -->
    <div class="custom-stats-panel" id="customStatsPanel">
      <h4>Choose Your Stats</h4>
      <form id="statsPrefsForm">
        <label><input type="checkbox" name="followage" /> Followed Since</label><br>
        <label><input type="checkbox" name="channelPoints" /> Channel Points</label><br>
        <label><input type="checkbox" name="messagesSent" /> Messages Sent</label><br>
        <label><input type="checkbox" name="badges" /> Badges</label><br>
        <label><input type="checkbox" name="subStatus" /> Sub Status</label><br>
        <label><input type="checkbox" name="viewerNumber" /> Viewer Number</label><br>
        <button type="submit">Save & Show</button>
        <button type="button" onclick="closeCustomStats()">Cancel</button>
      </form>
    </div>
    <div class="app-window-body" id="statsAppContainer" style="background-color: #000; color: #0f0; font-family: 'Fira Mono', monospace;">
      <div id="welcomeMessage" style="margin-bottom: 12px;"></div>
      <div id="cmdTerminal"></div>
      <div style="margin-top: 12px;">
        <button onclick="showBasicStats()">Get Stats</button>
        <button onclick="openCustomStats()">Custom Stats</button>
      </div>
    </div>
  </div>

  <!-- DOCK BAR -->
  <div id="dockBar">
    <button class="dock-btn" data-panel="streamInfoPanel" title="Stream Info">ğŸ¬</button>
    <button class="dock-btn" data-panel="chatPanel" title="Chat">ğŸ’¬</button>
    <button class="dock-btn" data-panel="pollPanel" title="Polls">ğŸ“Š</button>
    <button class="dock-btn" data-panel="linksPanel" title="Links">ğŸ”—</button>
    <button class="dock-btn" data-panel="freeModePanel" id="freeModeDockBtn" title="FreeMode">ğŸ–¥ï¸</button>
    <button id="customizeToggle" title="Customize Layout">ğŸ› ï¸</button>
  </div>

  <!-- PANELS -->
  <div id="streamInfoPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Stream Info <button class="close-btn" data-panel="streamInfoPanel">âœ–</button></div>
    <div class="panel-body" id="streamInfoBody"></div>
  </div>

  <div id="chatPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Chat <button class="close-btn" data-panel="chatPanel">âœ–</button></div>
    <div class="panel-body" id="chatBody">(Chat goes here)</div>
  </div>

  <div id="pollPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Polls <button class="close-btn" data-panel="pollPanel">âœ–</button></div>
    <div class="panel-body" id="pollBody">(Polls go here)</div>
  </div>

  <div id="linksPanel" class="panel" style="left: 60px; display: none;">
    <div class="panel-header">Links <button class="close-btn" data-panel="linksPanel">âœ–</button></div>
    <div class="panel-body">
      <ul class="links-list" id="popoutLinksList">
        <!-- Links will be dynamically inserted here -->
      </ul>
    </div>
  </div>

  <!-- FreeMode Panel (MUST be outside linksPanel, at root level) -->
  <div id="freeModePanel" class="panel" style="display:none; left:140px; top:80px; min-width:360px;">
    <div class="panel-header" onmousedown="startDrag(event)">FreeMode
      <button class="close-btn" data-panel="freeModePanel">âœ–</button>
    </div>
    <div class="panel-body" id="freeModeBody">
      <div style="margin-bottom:10px;">Drag and resize this panel! Click "Show Stream" below to open your Twitch stream.</div>
      <button id="showTwitchEmbedBtn" onclick="toggleTwitchEmbed()" style="margin-bottom:8px;">Show Stream</button>
      <div id="twitchEmbedPanel" style="display:none; resize:both; overflow:auto; min-width:320px; min-height:180px; border-radius:12px; box-shadow:0 0 8px #00fff7;"></div>
    </div>
  </div>
  <script src="script.js"></script>
  <script>
    // --- Toggle Apps Visibility Controls when Streaming button is clicked ---
    function toggleAppsVisibilityControls() {
      const controls = document.querySelector('.apps-visibility-controls');
      if (controls) {
        controls.style.display = (controls.style.display === 'none' || controls.style.display === '') ? 'block' : 'none';
      }
    }
    function loadDockVisibilityPrefs() {
      const prefs = JSON.parse(localStorage.getItem("dockVisibilityPrefs") || "{}");
      document.querySelectorAll('.dock-toggle').forEach(toggle => {
        const dockId = toggle.getAttribute('data-dock');
        toggle.checked = prefs[dockId] !== false;
        updateDockButtonVisibility(dockId, toggle.checked);
        toggle.addEventListener('change', function () {
          updateDockButtonVisibility(dockId, toggle.checked);
          saveDockVisibilityPrefs();
        });
      });
    }
    function updateDockButtonVisibility(dockId, show) {
      const btn = dockId === "customizeToggle"
        ? document.getElementById("customizeToggle")
        : document.querySelector('.dock-btn[data-panel="'+dockId+'"]');
      if (btn) btn.style.display = show ? "" : "none";
    }
    function saveDockVisibilityPrefs() {
      const prefs = {};
      document.querySelectorAll('.dock-toggle').forEach(toggle => {
        const dockId = toggle.getAttribute('data-dock');
        prefs[dockId] = toggle.checked;
      });
      localStorage.setItem("dockVisibilityPrefs", JSON.stringify(prefs));
    }
    window.addEventListener("DOMContentLoaded", loadDockVisibilityPrefs);

    // --- GAMING PANEL POPUP LOGIC ---
    document.getElementById('gamingAppIcon').onclick = function() {
      document.getElementById('gamingPanelOverlay').style.display = 'flex';
    };
    document.getElementById('closeGamingPanel').onclick = function() {
      document.getElementById('gamingPanelOverlay').style.display = 'none';
    };
    document.getElementById('gamingPanelOverlay').onclick = function(e) {
      if (e.target === document.getElementById('gamingPanelOverlay')) {
        document.getElementById('gamingPanelOverlay').style.display = 'none';
      }
    };

    // --- Show Slot Machine (new logic) ---
    document.getElementById('slotsBtn').onclick = function() {
      document.getElementById('gamingPanelOverlay').style.display = 'none';
      document.getElementById('slot-machine').style.display = 'block';
      if (typeof initSlotMachine === "function") initSlotMachine();
    };
    document.getElementById('slot-close').onclick = function() {
      document.getElementById('slot-machine').style.display = 'none';
      if (typeof initSlotMachine === "function") initSlotMachine();
    };
  </script>
  <script>
    // ===============================
    // Neon Slot Machine Full Logic
    // ===============================

    // --- Images for Slot Symbols ---
    const SLOT_SYMBOLS = [
      { img: 'assets/slots1.png', name: "Ember" },
      { img: 'assets/slots2.png', name: "Streamer Coin" },
      { img: 'assets/slots3.png', name: "GG" },
      { img: 'assets/slots4.png', name: "Streamer Face" },
      { img: 'assets/slots5.png', name: "Neon Star" },
      { img: 'assets/slots6.png', name: "Twitch Coin" },
      { img: 'assets/slots7.png', name: "Arcade" },
      { img: 'assets/slots8.png', name: "Jackpot" },
      { img: 'assets/slots9.png', name: "FREE SPIN" }
    ];

    let slotBalance = 0;
    let freeSpins = 0;
    let isSpinning = false;

    // DOM Elements (slot machine)
    const reels = [0, 1, 2].map(i => document.querySelector(`.slot-reel[data-reel="${i}"]`));
    const spinBtn = document.getElementById('slot-spin');
    const autoBtn = document.getElementById('slot-autospin');
    const msgEl = document.getElementById('slot-message');
    const fsEl = document.getElementById('slot-freespins');
    const balEl = document.getElementById('balanceAmount');
    const winlinesCanvas = document.getElementById('slot-winlines');
    const ctx = winlinesCanvas.getContext('2d');

    function randSymbol() {
      return Math.floor(Math.random() * SLOT_SYMBOLS.length);
    }

    function animateReel(reelIdx, result, duration = 900) {
      return new Promise(resolve => {
        const reel = reels[reelIdx];
        const steps = 18 + Math.floor(Math.random() * 6);
        let pos = 0;
        let lastTime = performance.now();

        reel.innerHTML = '';
        let queue = [];
        for (let i = 0; i < steps; i++) {
          const idx = randSymbol();
          queue.push(idx);
          const el = document.createElement('div');
          el.className = 'slot-symbol';
          el.innerHTML = `<img src="${SLOT_SYMBOLS[idx].img}" alt="">`;
          reel.appendChild(el);
        }
        for (let i = 0; i < 3; i++) {
          queue.push(result[i]);
          const el = document.createElement('div');
          el.className = 'slot-symbol';
          el.innerHTML = `<img src="${SLOT_SYMBOLS[result[i]].img}" alt="">`;
          reel.appendChild(el);
        }
        let offset = 0;
        function animate(time) {
          const dt = Math.min(24, time - lastTime);
          lastTime = time;
          offset += dt * (420 / duration);
          reel.style.transform = `translateY(${-offset}px)`;
          if (offset < (steps * 140)) {
            requestAnimationFrame(animate);
          } else {
            reel.innerHTML = '';
            for (let i = 0; i < 3; i++) {
              const idx = result[i];
              const el = document.createElement('div');
              el.className = 'slot-symbol';
              el.innerHTML = `<img src="${SLOT_SYMBOLS[idx].img}" alt="">`;
              reel.appendChild(el);
            }
            reel.style.transform = 'translateY(0)';
            resolve();
          }
        }
        requestAnimationFrame(animate);
      });
    }

    function getSpinResult() {
      return [
        [randSymbol(), randSymbol(), randSymbol()],
        [randSymbol(), randSymbol(), randSymbol()],
        [randSymbol(), randSymbol(), randSymbol()]
      ];
    }

    function drawWinLines(winLines) {
      ctx.clearRect(0, 0, winlinesCanvas.width, winlinesCanvas.height);
      winLines.forEach(line => {
        ctx.save();
        ctx.strokeStyle = line.color || "#ff0";
        ctx.shadowColor = line.color || "#ff0";
        ctx.shadowBlur = 12;
        ctx.lineWidth = 8;
        ctx.beginPath();
        const cell = (row, col) => [col * 140 + 70, row * 140 + 70];
        line.pts.forEach((pt, i) => {
          const [x, y] = cell(pt[0], pt[1]);
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.restore();
      });
    }

    function checkWin(resultGrid) {
      const rows = [0,1,2].map(r => [resultGrid[0][r], resultGrid[1][r], resultGrid[2][r]]);
      const cols = resultGrid;
      const diags = [
        [resultGrid[0][0], resultGrid[1][1], resultGrid[2][2]],
        [resultGrid[0][2], resultGrid[1][1], resultGrid[2][0]]
      ];

      let winLines = [];
      let bigWin = false;
      let freeSpinCount = 0;
      let winSymbols = [];

      for (let i = 0; i < 3; i++) {
        if (rows[i][0] === rows[i][1] && rows[i][1] === rows[i][2]) {
          winLines.push({ pts: [[i,0],[i,1],[i,2]], color: "#ff0" });
          winSymbols.push(SLOT_SYMBOLS[rows[i][0]].name);
          if (rows[i][0] === 8) bigWin = true;
        }
        if (cols[i][0] === cols[i][1] && cols[i][1] === cols[i][2]) {
          winLines.push({ pts: [[0,i],[1,i],[2,i]], color: "#0ff" });
          winSymbols.push(SLOT_SYMBOLS[cols[i][0]].name);
          if (cols[i][0] === 8) bigWin = true;
        }
      }
      if (diags[0][0] === diags[0][1] && diags[0][1] === diags[0][2]) {
        winLines.push({ pts: [[0,0],[1,1],[2,2]], color: "#ff00ea" });
        winSymbols.push(SLOT_SYMBOLS[diags[0][0]].name);
        if (diags[0][0] === 8) bigWin = true;
      }
      if (diags[1][0] === diags[1][1] && diags[1][1] === diags[1][2]) {
        winLines.push({ pts: [[2,0],[1,1],[0,2]], color: "#ffae00" });
        winSymbols.push(SLOT_SYMBOLS[diags[1][0]].name);
        if (diags[1][0] === 8) bigWin = true;
      }

      for (let c = 0; c < 3; c++) for (let r = 0; r < 3; r++) if (resultGrid[c][r] === 8) freeSpinCount++;

      return { winLines, bigWin, freeSpinCount, winSymbols };
    }

    async function spinSlots(isBonus = false) {
      if (isSpinning) return;
      isSpinning = true;
      spinBtn.disabled = true;
      autoBtn.disabled = true;
      msgEl.textContent = '';
      drawWinLines([]);

      let resultGrid = getSpinResult();

      await Promise.all([0,1,2].map(i => animateReel(i, resultGrid[i])));

      const { winLines, bigWin, freeSpinCount, winSymbols } = checkWin(resultGrid);

      drawWinLines(winLines);

      if (freeSpinCount >= 5) {
        freeSpins += 10;
        fsEl.textContent = `FREE SPINS +10!`;
        msgEl.textContent = "ğŸ‰ BONUS! 10 Free Spins Awarded!";
        // TODO: trigger special animation/sound
      } else if (winLines.length > 0) {
        msgEl.textContent = `WIN! ${winSymbols.join(", ")}`;
        // TODO: trigger win animation/sound
        if (bigWin) {
          // TODO: trigger "Big Win" overlay, chat message, badge, leaderboard
          msgEl.textContent = "ğŸ”¥ BIG WIN! ğŸ”¥";
        }
      } else {
        msgEl.textContent = "No win. Try again!";
        fsEl.textContent = '';
      }

      if (freeSpins > 0) {
        freeSpins--;
        fsEl.textContent = `Free Spins: ${freeSpins}`;
        setTimeout(() => spinSlots(false), 1200);
      } else {
        fsEl.textContent = '';
        spinBtn.disabled = false;
        autoBtn.disabled = false;
        isSpinning = false;
      }
    }

    spinBtn.onclick = async () => {
      // TODO: Integrate Twitch Bits API, unlock after Bits processed
      await spinSlots(false);
    };
    autoBtn.onclick = async () => {
      // TODO: Integrate Twitch Bits API (100 bits), unlock after Bits processed
      await spinSlots(true);
    };

    function initSlotMachine() {
      msgEl.textContent = '';
      fsEl.textContent = '';
      balEl.textContent = slotBalance;
      reels.forEach(r => r.innerHTML = '');
      drawWinLines([]);
      spinBtn.disabled = false;
      autoBtn.disabled = false;
      isSpinning = false;
    }

    // --- Slot close resets state (already handled above)
  </script>
</body>
</html>
